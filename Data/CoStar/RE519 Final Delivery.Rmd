---
title: "Re519 Final"
author: "Krista Yamamoto-Chin"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
# install.packages("readxl")
library(readxl)
library(dplyr)
library(stringr)

greater_seattle <- read_excel("~/Library/CloudStorage/OneDrive-UW/AU25/RE 519/Git/re519_group4_final_project/Data/CoStar/Greater Seattle AreaDataTable.xlsx", sheet = 1)  

bellevue_cbd <- read_excel("~/Library/CloudStorage/OneDrive-UW/AU25/RE 519/Git/re519_group4_final_project/Data/CoStar/Bellevue DataTable.xlsx", sheet = 1)

slu_cbd <- read_excel("~/Library/CloudStorage/OneDrive-UW/AU25/RE 519/Git/re519_group4_final_project/Data/CoStar/SLU DataTable.xlsx", sheet = 1)

greater_seattle <- greater_seattle %>%
  mutate(Year = as.numeric(str_extract(Period, "^\\d{4}"))) %>%
  filter(Year >= 2015, Year <= 2025) %>%
  mutate(Submarket = "Greater Seattle Metro")

bellevue_cbd <- bellevue_cbd %>%
  mutate(Year = as.numeric(str_extract(Period, "^\\d{4}")))%>%
  filter(Year >= 2015, Year <= 2025) %>%
  mutate(Submarket = "Bellevue CBD")

slu_cbd <- slu_cbd %>%
  mutate(Year = as.numeric(str_extract(Period, "^\\d{4}")))%>%
  filter(Year >= 2015, Year <= 2025)%>%
  mutate(Submarket = "South Lake Union CBD")

combined <- bind_rows(greater_seattle, bellevue_cbd, slu_cbd)

cleaned <- combined %>%
  filter(
    !str_detect(Period, "EST"),
    !str_detect(Period, "QTD")
  )

write.csv(cleaned, "Seattle_Submarkets_2015_2025.csv", row.names = FALSE)

```

```{r}

library(readxl)
library(dplyr)
library(tidyr)
library(stringr)


business <- read.csv("~/Library/CloudStorage/OneDrive-UW/AU25/RE 519/Git/re519_group4_final_project/Data/CES/BLS CES 2015-2025 Data for Washington - WAProfBusiness.csv")
information <- read.csv("~/Library/CloudStorage/OneDrive-UW/AU25/RE 519/Git/re519_group4_final_project/Data/CES/BLS CES 2015-2025 Data for Washington - WAInformation.csv")
total_emp <- read.csv("~/Library/CloudStorage/OneDrive-UW/AU25/RE 519/Git/re519_group4_final_project/Data/CES/BLS CES 2015-2025 Data for Washington - WATotalNonFarm.csv")

business <- business %>%
  mutate(across(Jan:Dec, ~ as.numeric(str_replace_all(.x, "\\(P\\)", "")))) %>%
  transmute(
    Year = as.integer(Year),
    Q1 = rowMeans(across(c(Jan, Feb, Mar)), na.rm = TRUE),
    Q2 = rowMeans(across(c(Apr, May, Jun)), na.rm = TRUE),
    Q3 = rowMeans(across(c(Jul, Aug, Sep)), na.rm = TRUE),
    Q4 = rowMeans(across(c(Oct, Nov, Dec)), na.rm = TRUE)
  ) %>%
  # pivot to long format for joining
  pivot_longer(
    cols = Q1:Q4,
    names_to = "Quarter",
    values_to = "Employment"
  ) %>%
  mutate (
    Industry = "Business"
  )

information <- information %>%
  mutate(across(Jan:Dec, ~ as.numeric(str_replace_all(.x, "\\(P\\)", "")))) %>%
  transmute(
    Year = as.integer(Year),
    Q1 = rowMeans(across(c(Jan, Feb, Mar)), na.rm = TRUE),
    Q2 = rowMeans(across(c(Apr, May, Jun)), na.rm = TRUE),
    Q3 = rowMeans(across(c(Jul, Aug, Sep)), na.rm = TRUE),
    Q4 = rowMeans(across(c(Oct, Nov, Dec)), na.rm = TRUE)
  ) %>%
  # pivot to long format for joining
  pivot_longer(
    cols = Q1:Q4,
    names_to = "Quarter",
    values_to = "Employment"
  )%>%
  mutate (
    Industry = "Information"
  )

total_emp <- total_emp %>%
  mutate(across(Jan:Dec, ~ as.numeric(str_replace_all(.x, "\\(P\\)", "")))) %>%
  transmute(
    Year = as.integer(Year),
    Q1 = rowMeans(across(c(Jan, Feb, Mar)), na.rm = TRUE),
    Q2 = rowMeans(across(c(Apr, May, Jun)), na.rm = TRUE),
    Q3 = rowMeans(across(c(Jul, Aug, Sep)), na.rm = TRUE),
    Q4 = rowMeans(across(c(Oct, Nov, Dec)), na.rm = TRUE)
  ) %>%
  # pivot to long format for joining
  pivot_longer(
    cols = Q1:Q4,
    names_to = "Quarter",
    values_to = "Employment"
  ) %>%
  mutate (
    Industry = "Total"
  )

employment <- bind_rows(total_emp, business, information)

employment <- employment %>%
  mutate(
    Period = paste0(Year, " ", Quarter)
  )

joined <- cleaned %>%
  left_join(employment %>% select(Period, Employment, Industry), by = "Period")

write.csv(joined, "Seattle_Submarkets_and_Employment_2015_2025.csv", row.names = FALSE)

```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
